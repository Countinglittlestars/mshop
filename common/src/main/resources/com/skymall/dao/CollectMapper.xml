<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skymall.dao.CollectMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.skymall.domain.Collect">
        <id column="id" property="id" />
        <result column="user_id" property="userId" />
        <result column="value_id" property="valueId" />
        <result column="add_time" property="addTime" />
        <result column="is_attention" property="isAttention" />
        <result column="type_id" property="typeId" />
    </resultMap>

    <select id="queryList" resultType="com.skymall.vo.wechat.CollectVo">
        select c.*,g.name, g.list_pic_url as listPicUrl, g.goods_brief as goodsBrief, g.retail_price as retailPrice
        from nideshop_collect c
        left join nideshop_goods g on c.value_id = g.id
        where 1 = 1
        <if test="userId != null and userId != ''">
            and c.user_id = #{userId}
        </if>
        <if test="value_id != null and value_id != ''">
            and c.value_id = #{value_id}
        </if>
        <if test="type_id != null and type_id != ''">
            and c.type_id = #{type_id}
        </if>
        <choose>
            <when test="sidx != null and sidx.trim() != ''">
                order by ${sidx} ${order}
            </when>
            <otherwise>
                order by c.id desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>

    </select>


    <select id="queryPage" resultType="com.skymall.vo.admin.CollectEntity" parameterType="com.skymall.dto.CollectQueryDto">
      select a.id as id , b.id as userId, b.username as userName,c.name as goodsName,
        c.goods_Sn goodsSn, c.is_on_sale as isOnSale, c.list_pic_url ListPicUrl
        from nideshop_collect a
        left join nideshop_user b on a.user_id = b.id
        left join nideshop_goods c on a.value_id = c.id
        where 1 = 1
        <if test="dto.userId != null">
              and b.id = #{dto.userId}
        </if>
        <if test="dto.userName != null">
            and b.username like concat('%', #{dto.userName}, '%')
        </if>
        order by a.id desc
    </select>

</mapper>
